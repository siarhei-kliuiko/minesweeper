(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var n=s.getElementsByTagName("script");if(n.length)for(var l=n.length-1;l>-1&&!t;)t=n[l--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{constructor(e){this.htmlElement=document.createElement("span"),this.htmlElement.className=`counter seconds-counter ${e}`,this.intervalId=null,this.setSeconds(0)}setSeconds(e){this.seconds=e,this.htmlElement.innerText=e}start(){null===this.intervalId&&(this.intervalId=setInterval(this.tick.bind(this),1e3))}tick(){this.setSeconds(this.seconds+1)}reset(){this.stop(),this.setSeconds(0)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}class s{constructor(e,t=0){this.initialValue=t,this.htmlElement=document.createElement("span"),this.htmlElement.className=`counter ${e}`,this.set(t)}set(e){this.count=e,this.htmlElement.innerText=e>=1e3?999:e<=-1e3?-999:e}increase(e=1){this.set(this.count+e)}decrease(e=1){if(0!==this.count){const t=this.count-e;t>=0?this.set(t):this.set(0)}}reset(e){e&&(this.initialValue=e),this.set(this.initialValue)}}const n=(e,t,s)=>{const n=document.createElement("button");return n.append(e),n.className=`button ${t}`,n.addEventListener("click",(()=>{s()})),n};class l{constructor(e){this.htmlElement=document.createElement("div"),this.htmlElement.className="overlay",e&&this.htmlElement.append(e);const t=document.body.clientWidth;document.body.classList.toggle("scroll-disable");const s=document.body.clientWidth-t;s&&(document.body.style.paddingRight=`${s}px`),document.body.prepend(this.htmlElement)}close(){this.htmlElement.remove(),document.body.classList.toggle("scroll-disable"),document.body.style.paddingRight=""}}class i{static getResultsBoard(){const e=document.createElement("div");e.className="game-results-board";const t=document.createElement("h2");t.className="game-results-board__title",t.innerText="Results";const s=document.createElement("ul");e.append(t,s);const n=JSON.parse(localStorage.getItem("results"));return n&&n.forEach((e=>{const t=document.createElement("li");t.className="game-results-board__record game-results-board__record_"+(e.isWin?"win":"lose"),t.innerText=`${e.isWin?"Win":"Lose"} in ${e.seconds} seconds with ${e.clicks} moves and ${e.mines} mines on ${e.difficulty} difficulty`,s.append(t)})),e}static addGameResult(e,t,s,n,l){const i={isWin:e,seconds:t,clicks:s,mines:n,difficulty:l};let o=JSON.parse(localStorage.getItem("results"));o?(o.push(i),o.length>10&&(o=o.slice(1,o.length))):o=[i],localStorage.setItem("results",JSON.stringify(o))}}const o={easy:{name:"easy",value:10},medium:{name:"medium",value:15},hard:{name:"hard",value:25}},c="light",a="dark";class m{static get(){let e=JSON.parse(localStorage.getItem("settings")),t=!1;if(e){const s=Number(e.difficulty.value),n=Number(e.minesCount);Number.isNaN(s)&&Number.isNaN(n)?t=!0:(Object.values(o).some((e=>e.value!==s))||(t=!0),e={difficulty:e.difficulty,minesCount:n,sounds:e.sounds,theme:e.theme})}else t=!0;return t&&(e={difficulty:o.easy,minesCount:10,sounds:!0,theme:a},localStorage.setItem("settings",JSON.stringify(e))),e}static set(e,t,s,n){const l=m.get();localStorage.setItem("settings",JSON.stringify({difficulty:e,minesCount:t,sounds:s,theme:n})),l.difficulty.value===e.value&&l.minesCount===t||m.mineFieldChanged(),l.sounds!==s&&m.soundMuteChanged()}}class r{static show(e,t="OK",s=null,i=null){const o=document.createElement("div");o.className="message-box";const c=document.createElement("div");c.className="message-box__buttons",o.append(e,c);const a=new l(o);if(s){const e=n(s,"message-box__button",(()=>{i&&(i(),a.close())}));c.append(e)}const m=n(t,"message-box__button",(()=>{a.close()}));c.append(m)}static showMessage(e){const t=document.createElement("h2");t.className="message-box__text",t.innerText=e,this.show(t)}static showGameResults(){this.show(i.getResultsBoard())}static showSettings(){const e=m.get(),t=document.createElement("div");t.className="settings-dialog";const s=document.createElement("h3");s.innerText="Difficulty:",t.append(s);const n=e.difficulty;let l=e.difficulty;const i=e=>{e.target.checked&&(l=o[e.target.id])};Object.values(o).forEach((e=>{const s=document.createElement("input");s.type="radio",s.id=e.name,s.className="settings-dialog__radio",s.name="difficulty",s.checked=e.value===n.value,s.addEventListener("change",i);const l=document.createElement("label");l.className="settings-dialog__label",l.innerText=e.name,l.htmlFor=s.id,t.append(s,l)}));const r=document.createElement("h3");r.innerText="Number of mines:";const d=document.createElement("div");d.className="settings-dialog__slider-wrapper";const h=document.createElement("input");h.className="settings-dialog__mines-slider",h.type="range",h.min=10,h.max=99,h.value=e.minesCount;const u=document.createElement("span");u.innerText=e.minesCount,u.className="settings-dialog__mines-count-output",h.addEventListener("input",(()=>{u.innerText=h.value})),d.append(h,u),t.append(r,d);const p=document.createElement("h3");p.innerText="Sounds:";const g=document.createElement("input");g.className="settings-dialog__sounds-checkbox",g.type="checkbox",g.id="sounds",g.checked=e.sounds;const _=document.createElement("label");_.className="settings-dialog__sounds-switch",_.htmlFor=g.id,t.append(p,g,_);const f=document.createElement("h3");f.innerText="Theme:";const E=document.createElement("input");E.className="settings-dialog__theme-checkbox",E.type="checkbox",E.id="theme",E.checked=e.theme===a,E.addEventListener("change",(()=>{E.checked?(e.theme=a,document.body.classList.add(a),document.body.classList.remove(c)):(e.theme=c,document.body.classList.add(c),document.body.classList.remove(a))}));const w=document.createElement("label");w.className="settings-dialog__theme-switch",w.htmlFor=E.id,t.append(f,E,w),this.show(t,"Cancel","Apply",(()=>{m.set(l,Number(h.value),g.checked,e.theme)}))}}const d=e.p+"assets/22bf853b225e66371832.mp3",h=e.p+"assets/923ef33b13e24b3b7188.mp3",u=e.p+"assets/196ab134892cd448cfe9.mp3",p=e.p+"assets/e599f6dd5c9a339cf278.mp3",g=e.p+"assets/d29c334392ff29425def.mp3",_=e.p+"assets/d25c4e59fd627287d4c5.mp3",f=e.p+"assets/747de3970faa1d08ca0c.mp3",E={gameStart:d,laugh:h,cheer:u,bark:e.p+"assets/fb33af3c0a27f0aa0e6f.mp3",mine:p,explosion:g,flag:_,breeze:f};class w{static isMuted=!m.get().sounds;static createSound(e){const t=new Audio(e);return t.volume=w.isMuted?0:1,t}static toggleMute(){w.isMuted=!w.isMuted}}m.soundMuteChanged=w.toggleMute;const b={empty:"minesweeper__mine-cell_type_empty",one:"minesweeper__mine-cell_type_one",two:"minesweeper__mine-cell_type_two",three:"minesweeper__mine-cell_type_three",four:"minesweeper__mine-cell_type_four",five:"minesweeper__mine-cell_type_five",six:"minesweeper__mine-cell_type_six",seven:"minesweeper__mine-cell_type_seven",eight:"minesweeper__mine-cell_type_eight",closed:"minesweeper__mine-cell_type_closed",mine:"minesweeper__mine-cell_type_mine"};class y{constructor(e){this.type=0,e?this.htmlElement=e:(this.htmlElement=document.createElement("div"),this.htmlElement.className=`minesweeper__mine-cell ${b.closed}`),this.isOpened=!1,this.isFlagged=!1}open(e=null){const t=s=>{"cell-opening"===s.animationName&&(this.htmlElement.classList.remove("minesweeper__mine-cell_animation_open"),this.htmlElement.removeEventListener("animationend",t),this.htmlElement.classList.add(this.type),e&&e())};this.htmlElement.addEventListener("animationend",t),this.setOpenedState(),this.htmlElement.classList.add("minesweeper__mine-cell_animation_open")}setOpenedState(){this.isOpened=!0,this.isFlagged=!1,this.htmlElement.classList.remove("minesweeper__mine-cell_state_flagged"),this.htmlElement.classList.remove(b.closed)}revealMine(e){const t=w.createSound(E.mine),s=n=>{"reveal-mine"===n.animationName?(t.addEventListener("ended",(()=>{this.htmlElement.addEventListener("animationstart",s,{once:!0}),this.htmlElement.classList.remove("minesweeper__mine-cell_animation_mine"),this.htmlElement.classList.add("minesweeper__mine-cell_animation_explode"),w.createSound(E.explosion).play()}),{once:!0}),t.play()):"cell-explode"===n.animationName&&e&&e()};this.htmlElement.addEventListener("animationstart",s,{once:!0}),this.htmlElement.classList.add("minesweeper__mine-cell_animation_mine")}reset(){this.type=0,this.isOpened=!1,this.isFlagged=!1,this.htmlElement.className=`minesweeper__mine-cell ${b.closed}`}toggleFlagged(e=!1){this.isFlagged=!this.isFlagged,this.htmlElement.classList.toggle("minesweeper__mine-cell_state_flagged"),e||w.createSound(E.flag).play()}}class C{constructor(e){this.cellsPerRow=e,this.htmlElement=document.createElement("div"),this.htmlElement.className="minesweeper__mine-field minesweeper__mine-field_disabled",this.htmlElement.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.cells=[];const t=this.createMineFieldFirstRow(this.cellsPerRow);this.htmlElement.append(t);for(let e=1;e<this.cellsPerRow;e+=1){const e=t.cloneNode(!0);this.htmlElement.append(e);for(let t=0;t<e.children.length;t+=1)this.cells.push(new y(e.children[t]))}window.addEventListener("resize",this.adjustFontSize.bind(this))}adjustFontSize(){let e=parseInt(getComputedStyle(this.cells[0].htmlElement).fontSize,10);for(;this.cells[0].htmlElement.scrollHeight<=this.cells[0].htmlElement.clientHeight;)e+=1,this.cells[0].htmlElement.style.fontSize=`${e}px`;for(;this.cells[0].htmlElement.scrollHeight>this.cells[0].htmlElement.clientHeight;)e-=1,this.cells[0].htmlElement.style.fontSize=`${e}px`;for(let t=1;t<this.cells.length;t+=1)this.cells[t].htmlElement.style.fontSize=`${e}px`}setSize(e,t){const s=500-2*t;let n=e;e<s&&(n=s);const l=window.innerWidth-2*t;e>=l&&(n=l),this.htmlElement.style.height=`${n}px`,this.htmlElement.style.width=`${n}px`}createMineFieldFirstRow(e){const t=document.createElement("div");t.className="minesweeper__mine-field-row";const s=(500/e-2)/500*100+"%";for(let n=0;n<e;n+=1){const e=new y;e.htmlElement.style.paddingLeft=s,e.htmlElement.style.paddingBottom=s,t.append(e.htmlElement),this.cells.push(e)}return t}enable(){this.htmlElement.classList.remove("minesweeper__mine-field_disabled")}disable(){this.htmlElement.classList.add("minesweeper__mine-field_disabled")}reset(){this.cells.forEach((e=>e.reset()))}getCellByCoordinates(e,t){return e>=0&&e<this.cellsPerRow&&t>=0&&t<this.cellsPerRow&&this.cells[e*this.cellsPerRow+t]}getCellCoordinates(e){const t=this.cells.indexOf(e),s=Math.floor(t/this.cellsPerRow);return{row:s,col:t-this.cellsPerRow*s}}modifySurroundingCells(e,t){const{row:s,col:n}=this.getCellCoordinates(e);for(let l=0;l<3;l+=1)for(let i=0;i<3;i+=1){const o=s-1+l,c=n-1+i,a=this.getCellByCoordinates(o,c);a&&a!==e&&t(a)}}placeMines(e,t){let s=0;const n=e=>{const t=e;t.type!==b.mine&&(t.type+=1)};for(let l=0;l<this.cells.length;l+=1)this.cells[l].htmlElement!==t&&(e-s)/(this.cells.length-l)>=Math.random()&&(this.cells[l].type=b.mine,this.modifySurroundingCells(this.cells[l],n),s+=1);if(e-s==1){const e=this.cells.filter((e=>e.type!==b.mine&&e.htmlElement!==t)),s=Math.floor(Math.random()*e.length);e[s].type=b.mine,this.modifySurroundingCells(e[s],n)}const l=Object.values(b);for(let e=0;e<this.cells.length;e+=1)this.cells[e].type!==b.mine&&(this.cells[e].type=l[this.cells[e].type])}isAllMineCellsFound(){return!this.cells.some((e=>!e.isOpened&&e.type!==b.mine))}openAllCells(){this.cells.filter((e=>!e.isOpened)).forEach((e=>e.open()))}openCell(e){const t=this.cells.find((t=>t.htmlElement===e));if(!t.isOpened&&!t.isFlagged){const e=t=>{t.isOpened||(t.open(),t.type===b.empty&&this.modifySurroundingCells(t,e))};switch(w.createSound(E.breeze).play(),this.disable(),t.type){case b.empty:e(t),this.enable();break;case b.mine:t.open((()=>this.mineCellClicked(t)));break;default:t.open((()=>this.enable()))}return!0}return!1}placeFlag(e){const t=this.cells.find((t=>t.htmlElement===e));return t.isOpened?{isFlagPlaced:!1,isAway:!t.isFlagged}:(t.toggleFlagged(),{isFlagPlaced:!0,isAway:!t.isFlagged})}}const v=!0,S=!1;class N{constructor({left:e,top:t},s){this.walkField=s,this.htmlElement=document.createElement("div"),this.htmlElement.className="dog",this.direction=v,this.setPosition(e,t)}static bark(){w.createSound(E.bark).play()}walkTo(e,t,s=null,n=0,l=null){setTimeout((()=>{this.htmlElement.classList.add("dog_animation_walk"),this.setPosition(e,t);const i=e=>{"top"!==e.propertyName&&"left"!==e.propertyName||(this.htmlElement.removeEventListener("transitionend",i),this.htmlElement.classList.remove("dog_animation_walk"),s&&s(n-1,l))};this.htmlElement.addEventListener("transitionend",i)}),900)}goForAWalk(e,t,s=null,n=null){if(e>0){const l=(()=>{const{top:e,bottom:t,left:s,right:n}=this.walkField.htmlElement.getBoundingClientRect(),{width:l,height:i}=this.htmlElement.getBoundingClientRect();return{x:Math.floor(Math.random()*(n-l-s+1)+s),y:Math.floor(Math.random()*(t-i-e+1)+e)}})();this.walkTo(s||l.x,n||l.y,this.goForAWalk.bind(this),e,t)}else t&&t()}setPosition(e,t){const{left:s,right:n}=this.htmlElement.getBoundingClientRect();this.direction===v&&e<n?this.setDirection(S):this.direction===S&&e>s&&this.setDirection(v),this.htmlElement.style.left=`${e}px`,this.htmlElement.style.top=`${t}px`}setDirection(e){e===v?(this.direction=v,this.htmlElement.classList.remove("dog_direction_left")):e===S&&(this.direction=S,this.htmlElement.classList.add("dog_direction_left"))}}class k{static current;static save(e,t,s,n,l){const i=e.cells.map((e=>({type:e.type,isOpened:e.isOpened,isFlagged:e.isFlagged}))),o={seconds:t.seconds,isEnabled:!!t.intervalId};localStorage.setItem("gameState",JSON.stringify({cellsInfo:i,secondCounterState:o,clicksCount:s.count,minesCount:n.count,flagsCount:l.count}))}static load(){k.current=JSON.parse(localStorage.getItem("gameState")),localStorage.removeItem("gameState")}}document.body.classList.add(m.get().theme),k.load();const L=(()=>{const e=document.createElement("div");return e.className="game-container",e})();document.body.append(L);const F=(()=>{const e=document.createElement("div");return e.className="minesweeper",e})();L.append(F);const x=new class{constructor(){this.htmlElement=document.createElement("div"),this.htmlElement.className="minesweeper__menu";const e=document.createElement("div");e.className="minesweeper__counters minesweeper__counters_left",this.secondsCounter=new t("minesweeper__seconds-counter"),this.clicksCounter=new s("clicks-counter minesweeper__clicks-counter"),e.append(this.secondsCounter.htmlElement,this.clicksCounter.htmlElement);const l=document.createElement("div");l.className="minesweeper_menu-controls";const i=document.createElement("div");i.className="minesweeper__buttons-container";const o=n("🏆","minesweeper__button",(()=>r.showGameResults())),c=n("⚙️","minesweeper__button",(()=>r.showSettings()));i.append(o,c),this.bush=(e=>{const t=document.createElement("div");return t.className=`bush ${e} bush_animation_idle`,t})("minesweeper__bush"),this.bush.addEventListener("click",(()=>{this.bushClicked&&(this.bush.classList.remove("bush_animation_idle"),this.bushClicked())})),l.append(i,this.bush);const a=document.createElement("div");var d;a.className="minesweeper__counters minesweeper__counters_right",this.minesCounter=(d=m.get().minesCount,new s("mines-counter minesweeper__mines-counter",d)),this.flagsCounter=new s("flags-counter minesweeper__flags-counter"),a.append(this.minesCounter.htmlElement,this.flagsCounter.htmlElement),this.htmlElement.append(e,l,a)}resetCounters(){this.secondsCounter.stop(),this.secondsCounter.reset(),this.clicksCounter.reset(),this.minesCounter.reset(m.get().minesCount),this.flagsCounter.reset()}};F.append(x.htmlElement);let R=new C(m.get().difficulty.value);F.append(R.htmlElement);let M=window.devicePixelRatio;const O=()=>{const e=window.devicePixelRatio;if(M===e){const e=parseInt(getComputedStyle(F).paddingBottom,10),t=R.htmlElement.getBoundingClientRect().top,s=window.innerHeight-t-e;R.setSize(s,e)}else M=e};O(),R.adjustFontSize(),window.addEventListener("resize",O);const I=(e,t)=>{t?(x.flagsCounter.decrease(e),x.flagsCounter.count<x.minesCounter.initialValue&&x.minesCounter.set(x.minesCounter.initialValue-x.flagsCounter.count)):(x.flagsCounter.increase(e),x.minesCounter.decrease(e))},$=e=>{const t=e.target.closest(".minesweeper__mine-cell");if(t)if(0===e.button){if(R.openCell(t)){x.clicksCounter.increase();const e=R.cells.filter((e=>e.isFlagged)).length;e!==x.flagsCounter.count&&I(x.flagsCounter.count-e,!0),R.isAllMineCellsFound()&&(x.secondsCounter.stop(),i.addGameResult(!0,x.secondsCounter.seconds,x.clicksCounter.count,m.get().minesCount,m.get().difficulty.name),R.disable(),R.openAllCells(),w.createSound(E.cheer).play(),r.showMessage(`Hooray! You found all mines in ${x.secondsCounter.seconds} seconds and ${x.clicksCounter.count} moves!`))}}else if(2===e.button){const e=R.placeFlag(t);e.isFlagPlaced&&(x.clicksCounter.increase(),I(1,e.isAway))}};if(k.current&&k.current.secondCounterState.isEnabled){x.secondsCounter.setSeconds(k.current.secondCounterState.seconds),x.clicksCounter.set(k.current.clicksCount),x.minesCounter.set(k.current.minesCount),x.flagsCounter.set(k.current.flagsCount);for(let e=0;e<R.cells.length;e+=1)R.cells[e].type=k.current.cellsInfo[e].type,k.current.cellsInfo[e].isOpened?(R.cells[e].htmlElement.classList.add(R.cells[e].type),R.cells[e].setOpenedState()):k.current.cellsInfo[e].isFlagged&&R.cells[e].toggleFlagged(!0);k.current=null,x.bush.classList.remove("bush_animation_idle"),R.enable(),R.htmlElement.addEventListener("mousedown",$),x.secondsCounter.start()}const T=e=>{const t=e.target.closest(".minesweeper__mine-cell");if(t)if(x.secondsCounter.start(),0===e.button)R.placeMines(m.get().minesCount,t),R.htmlElement.removeEventListener("mousedown",T),$(e),R.htmlElement.addEventListener("mousedown",$);else if(2===e.button){const e=R.placeFlag(t);e.isFlagPlaced&&(x.clicksCounter.increase(),I(1,e.isAway))}},P=()=>{x.bushClicked=null,x.resetCounters(),R.disable(),R.reset(),R.htmlElement.removeEventListener("mousedown",$),w.createSound(E.gameStart).play();const e=new N(x.bush.getBoundingClientRect(),R);F.append(e.htmlElement),e.goForAWalk(3,(()=>{const t=x.bush.getBoundingClientRect();N.bark(),e.goForAWalk(1,(()=>{e.htmlElement.remove(),R.enable(),x.bushClicked=P,R.htmlElement.addEventListener("mousedown",T)}),t.left,t.top)}))};x.bushClicked=P;const A=e=>{x.secondsCounter.stop(),i.addGameResult(!1,x.secondsCounter.seconds,x.clicksCounter.count,m.get().minesCount,m.get().difficulty.name),R.disable(),x.bushClicked=null,e.revealMine((()=>{x.bush.addEventListener("animationend",(e=>{"bush-dog"===e.animationName&&(x.bush.classList.remove("bush_animation_lose"),x.bush.classList.add("bush_animation_idle"),r.showMessage("Game over. Try again"),x.bushClicked=P)}),{once:!0}),w.createSound(E.laugh).play(),x.bush.classList.add("bush_animation_lose")}))};R.mineCellClicked=A,m.mineFieldChanged=()=>{x.resetCounters(),R.htmlElement.remove(),R=new C(m.get().difficulty.value),R.mineCellClicked=A,F.append(R.htmlElement),O(),R.adjustFontSize()},window.addEventListener("beforeunload",(()=>k.save(R,x.secondsCounter,x.clicksCounter,x.minesCounter,x.flagsCounter)))})();